<html>
  <head>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
<!-- Palette referecnce https://coolors.co/00e9e2-ff7984-f7a25f-65e7bb-ec83ab-9384e3 -->
    <style>
      body{
        font-family: 'Anton', sans-serif;
        text-shadow: 2px 2px #000000;
      }
      h1{
        font-size: 6em;
        /* color: #9384E3; */
        color: #00E9E2
      }
      h2{
        font-size: 4em;
        /* color: #65E7BB; */
        color: #FF7984;
      }
      #jarDiv{
        width:612px;
      position:relative;
      text-align:center;
      }
    #jar {
      opacity: 0;
      transition: opacity 1s;

      /* color:black; */
    }
    .text{
      position:absolute;
      left: 50%;
      transform: translate(-50%,-50%);
    }
    #top-text{
      top: 15%;
    }
    .fadeable{
      opacity: 0;
      transition: opacity 1s;
    }

    #middle-text{
      top: 50%;
    }
    #bot-text{
      top: 85%;
    }
    #top-text.fadeIn,#middle-text.fadeIn, #bot-text.fadeIn, #jar.fadeIn {
      opacity: 1;
      transition: opacity 1s;
    }
    </style>
    <script>
      let socket = io();
      let el;
      socket.on("connect", () => {
  console.log(socket.connected); // true
});
      // socket.on('time', (timeString) => {
      //   el = document.getElementById('server-time');
      //   el.innerHTML = timeString;
      // });
      socket.on('bot-connected',(payload)=> {
        console.log(payload);
        toggleJar(payload);
      })
      socket.on('swear',(payload)=> {
        console.log(payload);
        toggleJar(payload);
      })
      socket.on('bot-disconnected',(payload)=> {
        console.log(payload);
        toggleJar(payload);
})
async function toggleJar(payload){
  // payload can be used to contain things like message 1, message 2, top string, bot string, etc  
      document.getElementById('jar').classList.toggle('fadeIn');
        
      for(message of payload){
        duration = message.duration;
        delete message.duration;
        for(const [key, value] of Object.entries(message)){
          text = document.getElementById(key)
          text.innerText = value;
          text.classList.toggle('fadeIn');
        }       
        await new Promise(r => setTimeout(r, duration));  
        for(const [key, value] of Object.entries(message)){
          text = document.getElementById(key)          
          text.classList.toggle('fadeIn');
        }     
        await new Promise(r => setTimeout(r, duration));  
      }
        // payload.forEach(async (message) => {
        //   duration = message.duration;
        // delete message.duration;
        // for(const [key, value] of Object.entries(message)){
        //   text = document.getElementById(key)
        //   text.innerHTML = value;
        //   text.classList.toggle('fadeIn');
        // }       
        // await new Promise(r => setTimeout(r, duration));  
        // for(const [key, value] of Object.entries(message)){
        //   text = document.getElementById(key)
        //   text.innerHTML = value;
        //   text.classList.toggle('fadeIn');
        // }     
        // });
        

      document.getElementById('jar').classList.toggle('fadeIn');
}
// Payload design:
// payload{
//  messageCount: #,
//  messages{
//    top-text (opt): string,
//    middle-text (opt): string,
//    bot-text (opt): string,
//    length (default 2): #s
//  }
// }
    </script>
  </head>
  <body>
    <p id="server-time"></p>
    <div id=jarDiv>
      <img src='./jar.png' id='jar' style="width:100%" class="fadeable"/>
      <h2 id="top-text" class='fadeable text'></h2>
      <h1 id="middle-text" class='fadeable text'></h1>
      <h2 id="bot-text" class='fadeable text'></h2>
    </div>
  </body>
</html